@inherits LayoutComponentBase
@using Eggbox.Services
@using Eggbox.Models
@inject Mixer Mixer
@inject MixerModel Model

<div class="h-screen flex flex-col bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-300">

    @if (Mixer.State.IsConnected && !Model.IsInitialized)
    {
        <div class="
            p-4 shadow-sm h-screen w-screen flex flex-col items-center justify-center
            dark:bg-gray-800 dark:text-gray-200
        ">
            <p class="text-sm opacity-90">
                Loading mixer settings…
            </p>

            <div class="text-center mt-16 hue-rotate-180">
                <LoadingSpinner />
            </div>

            <p class="text-sm mt-2 opacity-90">
                @($"{Model.InitCompleted.Count}/{Model.InitExpected.Count}")
            </p>

            <div class="w-full bg-gray-500/60 h-3 rounded-xl mt-2">
                <div class="
                    h-3 rounded-xl transition-all duration-200
                    bg-primary
                    dark:bg-gray-200
                "
                style="width:@($"{Model.InitProgress*100:F0}%")">
                </div>
            </div>
        </div>
    }

    @if (!Mixer.State.IsConnected || Model.IsInitialized)
    {
        <div class="flex-1 overflow-auto">
            @Body
        </div>
    }

    @if (Mixer.State.IsConnected && Model.IsInitialized)
    {
        <nav class="flex justify-around items-center
            bg-white text-gray-600 border-t border-t-gray-100 dark:border-t-gray-900
            dark:bg-gray-900 dark:text-gray-300
        ">
            <NavLink href="@Routes.InOut"
                  class="nav-link" ActiveClass="active"
                Match="NavLinkMatch.All">
                <i class="fal fa-plug text-xl"></i>
                <span class="text-xs">In/Out</span>
            </NavLink>

            <NavLink href="@Routes.Mix"
                   class="nav-link" ActiveClass="active">
                <i class="fal fa-square-sliders-vertical text-xl"></i>
                <span class="text-xs">Mix</span>
            </NavLink>

            <NavLink href="@Routes.OscMonitor"
                class="nav-link" ActiveClass="active">
                <i class="fal fa-terminal text-xl"></i>
                <span class="text-xs">OSC</span>
            </NavLink>
        </nav>
    }
</div>

@code {

    protected override void OnInitialized()
    {
        Model.StateChanged += _ => InvokeAsync(StateHasChanged);
    }

}
